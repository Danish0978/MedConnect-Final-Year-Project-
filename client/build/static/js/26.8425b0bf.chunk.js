"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[26],{26:(e,s,i)=>{i.r(s),i.d(s,{default:()=>x});var a=i(5043),t=i(6213),n=i(3768),r=i(5369),c=i(9456),d=i(5089),l=i(8271),o=i(5560),h=i(1772),m=i(7070),u=i(579);t.A.defaults.baseURL="http://127.0.0.1:3000/api";const p=e=>`pharmacy_cart_${e||"guest"}`,x=()=>{const[e,s]=(0,a.useState)([]),[i,x]=(0,a.useState)([]),[j,v]=(0,a.useState)(0),[y,N]=(0,a.useState)(""),[g,f]=(0,a.useState)(null),[b,R]=(0,a.useState)(!1),[q,w]=(0,a.useState)(!1),[I,P]=(0,a.useState)(null),[S,C]=(0,a.useState)({name:"",address:"",city:"",phone:"",notes:""}),k=(0,c.wA)(),{loading:A}=(0,c.d4)((e=>e.root)),[F,_]=(0,a.useState)(null);(0,a.useEffect)((()=>{const e=localStorage.getItem("token");(async()=>{try{if(e){const s=(0,m.A)(e);_(s);const a=p(s.userId),t=localStorage.getItem(a);if(t)try{x(JSON.parse(t))}catch(i){localStorage.removeItem(a)}s.isPharmacyReceptionist?await O(e):await $(e)}else{_({isPharmacyReceptionist:!1,userId:null});const e=p(),s=localStorage.getItem(e);if(s)try{x(JSON.parse(s))}catch(i){localStorage.removeItem(e)}await $()}}catch(i){console.error("Initialization error:",i),_({isPharmacyReceptionist:!1,userId:null}),s([])}})()}),[]),(0,a.useEffect)((()=>{if(F){const e=p(F.userId);localStorage.setItem(e,JSON.stringify(i))}}),[i,F]);const O=async e=>{try{var s;k((0,d.r1)(!0));const i=await t.A.get("/pharmacy/my-pharmacy",{headers:{authorization:`Bearer ${e}`}});f((null===(s=i.data)||void 0===s?void 0:s.pharmacyId)||null),await T(e,i.data.pharmacyId)}catch(i){console.error("Pharmacy data error:",i),n.oR.error("Failed to fetch pharmacy data"),k((0,d.r1)(!1))}},T=async(e,i)=>{try{console.log(`Fetching medicines for pharmacy ${i}`);const a=await t.A.get(`/medicine/all/${i}`,{headers:{authorization:`Bearer ${e}`}});console.log("Pharmacy medicines response:",a.data),a.data.success&&s(a.data.data),k((0,d.r1)(!1))}catch(a){console.error("Error fetching pharmacy medicines:",a),n.oR.error("Failed to fetch pharmacy medicines"),k((0,d.r1)(!1))}},$=async e=>{try{var i;k((0,d.r1)(!0));const a=e?{headers:{authorization:`Bearer ${e}`}}:{},n=await t.A.get("/medicine/all",a);null!==(i=n.data)&&void 0!==i&&i.success&&Array.isArray(n.data.data)?s(n.data.data):s([])}catch(a){console.error("Fetch error:",a),s([]),n.oR.error("Failed to load medicines")}finally{k((0,d.r1)(!1))}},M=(e||[]).filter((e=>{if(!e||!e.name)return!1;const s=y.toLowerCase();return e.name.toLowerCase().includes(s)||e.genericName&&e.genericName.toLowerCase().includes(s)})),z=e=>{x(i.filter((s=>s._id!==e))),n.oR.success("Item removed from cart")},B=(s,a)=>{const t=e.find((e=>(null===e||void 0===e?void 0:e._id)===s));t&&(a>(t.quantity||0)?n.oR.error(`Only ${t.quantity} available in stock`):a<1?z(s):x(i.map((e=>e._id===s?{...e,quantity:a}:e))))},D=()=>i.reduce(((e,s)=>e+(s.price||0)*(s.quantity||0)),0),L=()=>D()-D()*(j/100),E=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{var s;k((0,d.r1)(!0));const r=localStorage.getItem("token");if(!r&&(null===F||void 0===F||!F.isPharmacyReceptionist))return n.oR.error("You need to be logged in to checkout"),void k((0,d.r1)(!1));const c={items:i.map((e=>({medicineId:e._id,quantity:e.quantity,price:e.price}))),totalAmount:L(),...(null===F||void 0===F?void 0:F.isPharmacyReceptionist)&&{discount:j,pharmacyId:g},...!(null!==F&&void 0!==F&&F.isPharmacyReceptionist)&&{shippingInfo:e,patientId:null===F||void 0===F?void 0:F.userId}},l=await t.A.post("/order/",c,{headers:{authorization:`Bearer ${r}`}});var a;if(null!==(s=l.data)&&void 0!==s&&s.success)P({...l.data,order:(null===(a=l.data.orders)||void 0===a?void 0:a[0])||l.data.order}),w(!0),R(!1),(()=>{x([]);const e=p(null===F||void 0===F?void 0:F.userId);localStorage.removeItem(e)})(),v(0);k((0,d.r1)(!1))}catch(l){var r,c;n.oR.error((null===(r=l.response)||void 0===r||null===(c=r.data)||void 0===c?void 0:c.message)||"Failed to place order"),k((0,d.r1)(!1))}},Y=e=>{e.preventDefault(),E(S)},H=()=>{const e=document.getElementById("receipt-print"),s=window.open("","","width=800,height=600");s.document.write(`\n      <html>\n        <head>\n          <title>MedConnect Receipt</title>\n          <style>\n            body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }\n            .print-header { text-align: center; margin-bottom: 20px; }\n            .print-header h1 { color: #2c7be5; margin: 0; }\n            .print-header p { margin: 5px 0; color: #666; }\n            table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n            th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }\n            .total-row { display: flex; justify-content: space-between; margin: 5px 0; }\n            .grand-total { font-weight: bold; font-size: 1.1em; margin-top: 10px; }\n            @media print {\n              body { padding: 0; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class="print-header">\n            <h1>MedConnect</h1>\n            <p>Medical Order Receipt</p>\n          </div>\n          <div id="receipt-content">\n            ${e.innerHTML}\n          </div>\n          <script>\n            window.onload = function() {\n              setTimeout(() => {\n                window.print();\n                window.close();\n              }, 200);\n            }\n          <\/script>\n        </body>\n      </html>\n    `),s.document.close()};if(q&&I){const e=I.orders||[I.order],s=I.isMultiPharmacy;return(0,u.jsxs)("div",{className:"pharmacy-sales-container",children:[(0,u.jsx)(h.A,{}),(0,u.jsx)("div",{className:"receipt-container",children:(0,u.jsxs)("div",{className:"receipt",id:"receipt-print",children:[(0,u.jsx)("h2",{children:"Order Confirmation"}),s&&(0,u.jsxs)("div",{className:"multi-order-notice",children:[(0,u.jsx)("p",{children:"Your order contains items from multiple pharmacies and has been split into separate orders:"}),(0,u.jsxs)("p",{className:"order-numbers",children:["Order Numbers: ",I.orderNumbers]})]}),e.map(((e,s)=>{var i,a,t;return(0,u.jsxs)("div",{className:"order-receipt",children:[(0,u.jsxs)("div",{className:"receipt-header",children:[(0,u.jsxs)("p",{children:["Order #: ",e.orderNumber]}),(0,u.jsxs)("p",{children:["Date: ",new Date(e.createdAt).toLocaleString()]}),e.pharmacy&&(0,u.jsxs)("div",{className:"pharmacy-info",children:[(0,u.jsxs)("h4",{children:["Pharmacy: ",e.pharmacy.name]}),(0,u.jsx)("p",{children:e.pharmacy.address})]})]}),(0,u.jsxs)("div",{className:"receipt-body",children:["online"===e.orderType&&e.shippingInfo&&(0,u.jsxs)("div",{className:"shipping-info",children:[(0,u.jsx)("h3",{children:"Shipping Information"}),(0,u.jsxs)("p",{children:["Name: ",e.shippingInfo.name]}),(0,u.jsxs)("p",{children:["Address: ",e.shippingInfo.address]}),(0,u.jsxs)("p",{children:["City: ",e.shippingInfo.city]}),(0,u.jsxs)("p",{children:["Phone: ",e.shippingInfo.phone]}),e.shippingInfo.notes&&(0,u.jsxs)("p",{children:["Notes: ",e.shippingInfo.notes]})]}),(0,u.jsxs)("div",{className:"order-items",children:[(0,u.jsx)("h3",{children:"Order Summary"}),(0,u.jsxs)("table",{children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Item"}),(0,u.jsx)("th",{children:"Qty"}),(0,u.jsx)("th",{children:"Price"}),(0,u.jsx)("th",{children:"Total"})]})}),(0,u.jsx)("tbody",{children:null===(i=e.items)||void 0===i?void 0:i.map(((e,s)=>{var i,a;return(0,u.jsxs)("tr",{children:[(0,u.jsx)("td",{children:null===(i=e.medicineId)||void 0===i?void 0:i.name}),(0,u.jsx)("td",{children:e.quantity}),(0,u.jsxs)("td",{children:["Rs. ",null===(a=e.price)||void 0===a?void 0:a.toFixed(2)]}),(0,u.jsxs)("td",{children:["Rs. ",(e.price*e.quantity).toFixed(2)]})]},s)}))})]})]}),(0,u.jsxs)("div",{className:"order-total",children:[(0,u.jsxs)("div",{className:"total-row",children:[(0,u.jsx)("span",{children:"Subtotal:"}),(0,u.jsxs)("span",{children:["Rs. ",null===(a=e.subTotal)||void 0===a?void 0:a.toFixed(2)]})]}),e.discount>0&&(0,u.jsxs)("div",{className:"total-row",children:[(0,u.jsxs)("span",{children:["Discount (",e.discount,"%):"]}),(0,u.jsxs)("span",{children:["- Rs. ",(e.subTotal*e.discount/100).toFixed(2)]})]}),(0,u.jsxs)("div",{className:"total-row grand-total",children:[(0,u.jsx)("span",{children:"Total:"}),(0,u.jsxs)("span",{children:["Rs. ",null===(t=e.totalAmount)||void 0===t?void 0:t.toFixed(2)]})]})]})]})]},s)})),(0,u.jsxs)("div",{className:"receipt-actions",children:[(0,u.jsxs)("button",{onClick:H,className:"print-btn",children:[(0,u.jsx)(r.n4o,{})," Print Receipt"]}),(0,u.jsxs)("button",{onClick:()=>{w(!1),P(null)},className:"home-btn",children:[(0,u.jsx)(r.rQ8,{})," Back to Home"]})]})]})}),(0,u.jsx)(o.A,{})]})}return b?(0,u.jsxs)("div",{className:"pharmacy-sales-container",children:[(0,u.jsx)(h.A,{}),(0,u.jsx)("div",{className:"checkout-form-container",children:(0,u.jsxs)("form",{onSubmit:Y,className:"checkout-form",children:[(0,u.jsx)("h2",{children:"Shipping Information"}),(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"Full Name *"}),(0,u.jsx)("input",{type:"text",required:!0,value:S.name,onChange:e=>C({...S,name:e.target.value})})]}),(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"Address *"}),(0,u.jsx)("input",{type:"text",required:!0,value:S.address,onChange:e=>C({...S,address:e.target.value})})]}),(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"City *"}),(0,u.jsx)("input",{type:"text",required:!0,value:S.city,onChange:e=>C({...S,city:e.target.value})})]}),(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"Phone Number *"}),(0,u.jsx)("input",{type:"tel",required:!0,value:S.phone,onChange:e=>C({...S,phone:e.target.value})})]}),(0,u.jsxs)("div",{className:"form-group",children:[(0,u.jsx)("label",{children:"Notes (Optional)"}),(0,u.jsx)("textarea",{value:S.notes,onChange:e=>C({...S,notes:e.target.value})})]}),(0,u.jsxs)("div",{className:"order-summary",children:[(0,u.jsx)("h3",{children:"Order Summary"}),i.map((e=>(0,u.jsxs)("div",{className:"order-item",children:[(0,u.jsxs)("span",{children:[e.name," x ",e.quantity]}),(0,u.jsxs)("span",{children:["Rs. ",(e.price*e.quantity).toFixed(2)]})]},e._id))),(0,u.jsxs)("div",{className:"order-total",children:[(0,u.jsx)("span",{children:"Total:"}),(0,u.jsxs)("span",{children:["Rs. ",D().toFixed(2)]})]})]}),(0,u.jsxs)("div",{className:"form-actions",children:[(0,u.jsx)("button",{type:"button",onClick:()=>R(!1),className:"cancel-btn",children:"Cancel"}),(0,u.jsx)("button",{type:"submit",className:"submit-btn",children:"Place Order"})]})]})}),(0,u.jsx)(o.A,{})]}):(0,u.jsxs)("div",{className:"pharmacy-sales-container",children:[(0,u.jsx)(h.A,{}),(0,u.jsx)("div",{className:"pharmacy-content",children:A?(0,u.jsx)(l.A,{}):(0,u.jsxs)("main",{className:"pharmacy-main",children:[(0,u.jsx)("h2",{className:"pharmacy-title",children:null!==F&&void 0!==F&&F.isPharmacyReceptionist?"Pharmacy Inventory":"Pharmacy Store"}),(0,u.jsx)("div",{className:"search-controls",children:(0,u.jsx)("div",{className:"search-input-group",children:(0,u.jsx)("input",{type:"text",className:"search-input",placeholder:"\ud83d\udd0d Search medicines by name or generic name...",value:y,onChange:e=>N(e.target.value)})})}),(0,u.jsxs)("div",{className:"pharmacy-layout",children:[(0,u.jsxs)("div",{className:"medicine-list-section",children:[(0,u.jsxs)("div",{className:"table-header",children:[(0,u.jsx)("h3",{children:"Available Medicines"}),(0,u.jsxs)("span",{className:"results-count",children:[M.length," items found"]})]}),(0,u.jsx)("div",{className:"table-container",children:(0,u.jsxs)("table",{className:"medicines-table",children:[(0,u.jsx)("thead",{children:(0,u.jsxs)("tr",{children:[(0,u.jsx)("th",{children:"Name"}),(0,u.jsx)("th",{children:"Generic Name"}),(0,u.jsx)("th",{children:"Formula"}),(0,u.jsx)("th",{children:"Manufacturer"}),(0,u.jsx)("th",{children:"Dosage"}),(null===F||void 0===F?void 0:F.isPharmacyReceptionist)&&(0,u.jsx)("th",{children:"Stock"}),(0,u.jsx)("th",{children:"Price"}),!(null!==F&&void 0!==F&&F.isPharmacyReceptionist)&&(0,u.jsx)("th",{children:"Pharmacy"}),(0,u.jsx)("th",{children:"Action"})]})}),(0,u.jsx)("tbody",{children:M.length>0?M.map((e=>{var s;return e&&(0,u.jsxs)("tr",{className:(e.quantity||0)<=0?"out-of-stock":"",children:[(0,u.jsx)("td",{children:(0,u.jsxs)("div",{className:"medicine-name",children:[e.name,e.prescriptionRequired&&(0,u.jsx)("span",{className:"prescription-badge",children:"Rx"})]})}),(0,u.jsx)("td",{children:e.genericName||"-"}),(0,u.jsx)("td",{children:e.formula||"-"}),(0,u.jsx)("td",{children:e.manufacturer||"-"}),(0,u.jsx)("td",{children:e.dosage||"-"}),(null===F||void 0===F?void 0:F.isPharmacyReceptionist)&&(0,u.jsx)("td",{children:(0,u.jsx)("span",{className:"stock-badge "+((e.quantity||0)<=0?"out":(e.quantity||0)<=10?"low":"in"),children:(e.quantity||0)<=0?"Out of stock":e.quantity})}),(0,u.jsxs)("td",{children:["Rs. ",(null===(s=e.price)||void 0===s?void 0:s.toFixed(2))||"0.00"]}),!(null!==F&&void 0!==F&&F.isPharmacyReceptionist)&&(0,u.jsx)("td",{className:"pharmacy-info",children:e.pharmacyId&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"pharmacy-name",children:e.pharmacyId.name}),(0,u.jsx)("div",{className:"pharmacy-address",children:e.pharmacyId.address})]})}),(0,u.jsx)("td",{children:(0,u.jsx)("button",{className:"add-to-cart-btn "+(null!==F&&void 0!==F&&F.isPharmacyReceptionist||!e.prescriptionRequired?"":"disabled"),onClick:()=>(e=>{if(!e)return;if((null===F||void 0===F||!F.isPharmacyReceptionist)&&e.prescriptionRequired)return void n.oR.error("This medicine requires a prescription");const s=i.find((s=>s._id===e._id));let a;if(s){if(s.quantity>=(e.quantity||0))return void n.oR.error("Cannot add more than available stock");a=i.map((s=>s._id===e._id?{...s,quantity:s.quantity+1}:s))}else a=[...i,{...e,quantity:1}];x(a),n.oR.success(`${e.name} added to cart`)})(e),disabled:(e.quantity||0)<=0||!(null!==F&&void 0!==F&&F.isPharmacyReceptionist)&&e.prescriptionRequired,children:(e.quantity||0)<=0?"Out of stock":null!==F&&void 0!==F&&F.isPharmacyReceptionist||!e.prescriptionRequired?"Add to Cart":"Prescription Required"})})]},e._id)})):(0,u.jsx)("tr",{className:"no-results",children:(0,u.jsx)("td",{colSpan:null!==F&&void 0!==F&&F.isPharmacyReceptionist?7:8,children:"No medicines found matching your criteria"})})})]})})]}),(0,u.jsx)("div",{className:"cart-section",children:(0,u.jsxs)("div",{className:"cart-card",children:[(0,u.jsxs)("h3",{className:"cart-title",children:["Your Cart (",i.length,")"]}),i.length>0?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"cart-items-list",children:i.map((s=>{var i;const a=e.find((e=>(null===e||void 0===e?void 0:e._id)===(null===s||void 0===s?void 0:s._id)));return(0,u.jsxs)("div",{className:"cart-item",children:[(0,u.jsxs)("div",{className:"cart-item-info",children:[(0,u.jsx)("span",{className:"item-name",children:s.name}),(0,u.jsxs)("span",{className:"item-price",children:["Rs. ",null===(i=s.price)||void 0===i?void 0:i.toFixed(2)]})]}),(0,u.jsxs)("div",{className:"item-controls",children:[(0,u.jsxs)("div",{className:"quantity-adjuster",children:[(0,u.jsx)("button",{className:"quantity-btn minus",onClick:()=>B(s._id,(s.quantity||0)-1),children:"-"}),(0,u.jsx)("span",{className:"quantity",children:s.quantity}),(0,u.jsx)("button",{className:"quantity-btn plus",onClick:()=>B(s._id,(s.quantity||0)+1),disabled:(s.quantity||0)>=((null===a||void 0===a?void 0:a.quantity)||0),children:"+"})]}),(0,u.jsx)("button",{className:"remove-item-btn",onClick:()=>z(s._id),children:"Remove"})]})]},s._id)}))}),(0,u.jsxs)("div",{className:"cart-summary",children:[(0,u.jsxs)("div",{className:"summary-row",children:[(0,u.jsx)("span",{children:"Subtotal:"}),(0,u.jsxs)("span",{children:["Rs. ",D().toFixed(2)]})]}),(null===F||void 0===F?void 0:F.isPharmacyReceptionist)&&(0,u.jsxs)("div",{className:"summary-row discount-row",children:[(0,u.jsx)("label",{children:"Discount:"}),(0,u.jsxs)("div",{className:"discount-input-group",children:[(0,u.jsx)("input",{type:"number",min:"0",max:"100",value:j,onChange:e=>{const s=Math.min(100,Math.max(0,Number(e.target.value)));v(s)},placeholder:"0"}),(0,u.jsx)("span",{children:"%"})]})]}),(0,u.jsxs)("div",{className:"summary-row total-row",children:[(0,u.jsx)("span",{children:"Total:"}),(0,u.jsxs)("span",{className:"total-amount",children:["Rs. ",null!==F&&void 0!==F&&F.isPharmacyReceptionist?L().toFixed(2):D().toFixed(2)]})]}),(0,u.jsx)("button",{className:"checkout-btn",onClick:async()=>{null!==F&&void 0!==F&&F.isPharmacyReceptionist?await E():R(!0)},children:null!==F&&void 0!==F&&F.isPharmacyReceptionist?"Checkout":"Proceed to Checkout"})]})]}):(0,u.jsxs)("div",{className:"empty-cart",children:[(0,u.jsx)(r.AsH,{className:"empty-cart-icon",size:48}),(0,u.jsx)("p",{children:"Your cart is empty"}),(0,u.jsx)("small",{children:"Add medicines from the list"})]})]})})]})]})}),(0,u.jsx)(o.A,{})]})}}}]);
//# sourceMappingURL=26.8425b0bf.chunk.js.map