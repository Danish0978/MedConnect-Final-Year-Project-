"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[139],{5139:(e,t,i)=>{i.r(t),i.d(t,{default:()=>b});var o=i(5043),n=i(6760),d=i(5560),s=i(1772),l=i(5789),a=i(5089),r=i(8271),c=i(9456),u=i(7070),m=i(6213),p=i(3768),v=(i(8067),i(3216)),h=i(6998),x=i(579);const b=()=>{var e;const[t,i]=(0,o.useState)([]),[b,j]=(0,o.useState)(null),[g,f]=(0,o.useState)(!1),[y,A]=(0,o.useState)({}),I=(0,c.wA)(),{loading:k}=(0,c.d4)((e=>e.root)),{userId:w,isDoctor:S,isReceptionist:C}=(0,u.A)(localStorage.getItem("token")),N=(0,v.Zp)(),_=async()=>{try{I((0,a.r1)(!0));const e=await(0,l.A)("/appointment/getappointments");i(e);const t=await Promise.all(e.filter((e=>"Completed"===e.status&&!S)).map((e=>m.A.get(`/feedback/exists/appointment/${e._id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})))),o={};t.forEach(((t,i)=>{const n=e.filter((e=>"Completed"===e.status&&!S))[i]._id;o[n]=t.data.exists})),A(o),I((0,a.r1)(!1))}catch(e){console.error(e),I((0,a.r1)(!1))}};(0,o.useEffect)((()=>{_()}),[]);return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(s.A,{}),k?(0,x.jsx)(r.A,{}):(0,x.jsxs)("section",{className:"container notif-section",children:[(0,x.jsx)("h2",{className:"page-heading",children:"Your Appointments"}),t.length>0?(0,x.jsx)("div",{className:"appointments-container",children:(0,x.jsxs)("table",{className:"appointments-table",children:[(0,x.jsx)("thead",{children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{children:"S.No"}),(0,x.jsx)("th",{children:"Doctor"}),(0,x.jsx)("th",{children:"Patient"}),(0,x.jsx)("th",{children:"Appointment Date"}),(0,x.jsx)("th",{children:"Appointment Time"}),(0,x.jsx)("th",{children:"Booking Date"}),(0,x.jsx)("th",{children:"Booking Time"}),(0,x.jsx)("th",{children:"Status"}),S?(0,x.jsx)("th",{children:"Action"}):C?null:(0,x.jsx)("th",{children:"Review"})]})}),(0,x.jsx)("tbody",{children:null===t||void 0===t?void 0:t.map(((e,t)=>{var i,o,n,d;return(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{children:t+1}),(0,x.jsx)("td",{children:(null===e||void 0===e||null===(i=e.doctorId)||void 0===i?void 0:i.firstname)+" "+(null===e||void 0===e||null===(o=e.doctorId)||void 0===o?void 0:o.lastname)}),(0,x.jsx)("td",{children:(null===e||void 0===e||null===(n=e.userId)||void 0===n?void 0:n.firstname)+" "+(null===e||void 0===e||null===(d=e.userId)||void 0===d?void 0:d.lastname)}),(0,x.jsx)("td",{children:null===e||void 0===e?void 0:e.date}),(0,x.jsx)("td",{children:null===e||void 0===e?void 0:e.time}),(0,x.jsx)("td",{children:null===e||void 0===e?void 0:e.createdAt.split("T")[0]}),(0,x.jsx)("td",{children:null===e||void 0===e?void 0:e.updatedAt.split("T")[1].split(".")[0]}),(0,x.jsx)("td",{children:null===e||void 0===e?void 0:e.status}),S?(0,x.jsx)("td",{children:(0,x.jsxs)("div",{className:"action-buttons",children:[(0,x.jsx)("button",{className:"accept-btn "+("Completed"===(null===e||void 0===e?void 0:e.status)?"disable-btn":""),disabled:"Completed"===(null===e||void 0===e?void 0:e.status),onClick:()=>(async e=>{try{var t,i,o;const{data:n}=await p.Ay.promise(m.A.put("/appointment/completed",{appointid:null===e||void 0===e?void 0:e._id,doctorId:null===e||void 0===e||null===(t=e.doctorId)||void 0===t?void 0:t._id,doctorname:`${null===e||void 0===e||null===(i=e.userId)||void 0===i?void 0:i.firstname} ${null===e||void 0===e||null===(o=e.userId)||void 0===o?void 0:o.lastname}`},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),{success:"Appointment completed successfully",error:"Unable to complete appointment",loading:"Completing appointment..."});await _()}catch(n){return n}})(e),children:"Complete"}),(0,x.jsx)("button",{className:"prescription-btn "+("Completed"===(null===e||void 0===e?void 0:e.status)?"disable-btn":""),disabled:"Completed"===(null===e||void 0===e?void 0:e.status),onClick:()=>{var t;N("/add-prescription",{state:{appointmentId:(t=e)._id,patientId:t.userId._id,doctorId:t.doctorId._id}})},children:"Add Prescription"})]})}):!C&&(0,x.jsx)("td",{children:(0,x.jsx)("button",{className:"review-btn "+("Completed"!==(null===e||void 0===e?void 0:e.status)||y[e._id]?"disable-btn":""),disabled:"Completed"!==(null===e||void 0===e?void 0:e.status)||y[e._id],onClick:()=>(j(e),void f(!0)),children:y[e._id]?"Reviewed":"Leave Review"})})]},null===e||void 0===e?void 0:e._id)}))})]})}):(0,x.jsx)(n.A,{})]}),g&&(0,x.jsx)(h.A,{appointment:b,onClose:()=>f(!1),onSubmit:async()=>{await _(),f(!1)},entityType:"doctor",entityId:null===b||void 0===b||null===(e=b.doctorId)||void 0===e?void 0:e._id}),(0,x.jsx)(d.A,{})]})}},6998:(e,t,i)=>{i.d(t,{A:()=>a});var o=i(5043),n=i(5369),d=i(6213),s=i(3768),l=i(579);const a=e=>{var t,i,a;let{order:r,appointment:c,onClose:u,onSubmit:m,entityType:p,entityId:v}=e;const[h,x]=(0,o.useState)(0),[b,j]=(0,o.useState)(null),[g,f]=(0,o.useState)(""),[y,A]=(0,o.useState)(!1),I="doctor"===p?`${null===c||void 0===c||null===(t=c.doctorId)||void 0===t?void 0:t.firstname} ${null===c||void 0===c||null===(i=c.doctorId)||void 0===i?void 0:i.lastname}`:null===r||void 0===r||null===(a=r.pharmacy)||void 0===a?void 0:a.name;return(0,l.jsx)("div",{className:"feedback-modal-overlay",children:(0,l.jsxs)("div",{className:"feedback-modal",children:[(0,l.jsx)("button",{className:"close-btn",onClick:u,children:"\xd7"}),(0,l.jsx)("h2",{children:"Rate Your Experience"}),(0,l.jsxs)("p",{children:["How was your ","doctor"===p?"appointment":"order"," with ",I,"?"]}),(0,l.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),0!==h){A(!0);try{if(!p)throw new Error("Missing entity type");if(!v)throw new Error("Missing entity Id");const e={type:p,entityId:v,rating:h,comment:g||""};if("doctor"===p){if(null===c||void 0===c||!c._id)throw new Error("Appointment information is missing");e.appointmentId=c._id}else{if(null===r||void 0===r||!r._id)throw new Error("Order information is missing");e.orderId=r._id}console.log("Submitting feedback with payload:",e),await s.Ay.promise(d.A.post("/feedback/submit",e,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}}),{loading:"Submitting feedback...",success:"Feedback submitted successfully!",error:e=>{var t,i;return(null===(t=e.response)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.message)||e.message||"Failed to submit feedback"}}),m()}catch(t){console.error("Feedback submission error:",t),s.Ay.error(t.message)}finally{A(!1)}}else s.Ay.error("Please select a rating")},children:[(0,l.jsx)("div",{className:"star-rating",children:[...Array(5)].map(((e,t)=>{const i=t+1;return(0,l.jsxs)("label",{children:[(0,l.jsx)("input",{type:"radio",name:"rating",value:i,onClick:()=>x(i)}),(0,l.jsx)(n.gt3,{className:"star",color:i<=(b||h)?"#ffc107":"#e4e5e9",size:40,onMouseEnter:()=>j(i),onMouseLeave:()=>j(null)})]},t)}))}),(0,l.jsxs)("div",{className:"form-group",children:[(0,l.jsx)("label",{htmlFor:"comment",children:"Your Feedback (optional)"}),(0,l.jsx)("textarea",{id:"comment",rows:"4",value:g,onChange:e=>f(e.target.value),placeholder:`Share details about your ${"doctor"===p?"appointment":"order"} experience...`})]}),(0,l.jsx)("button",{type:"submit",className:"submit-btn",disabled:0===h||y,children:y?"Submitting...":"Submit Feedback"})]})]})})}}}]);
//# sourceMappingURL=139.fd9617f1.chunk.js.map