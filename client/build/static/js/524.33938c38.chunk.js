"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[524],{2524:(e,s,r)=>{r.r(s),r.d(s,{default:()=>u});var a=r(5043),t=r(3216),i=r(6213),n=r(3768),d=r(9456),l=r(1772),o=r(5560),c=r(5369),m=r(6998),h=r(579);const u=()=>{const{user:e}=(0,d.d4)((e=>e.root)),[s,r]=(0,a.useState)([]),[u,p]=(0,a.useState)(!0),[x,j]=(0,a.useState)(""),[v,g]=(0,a.useState)(null),[b,N]=(0,a.useState)(!1),[y,f]=(0,a.useState)({}),w=(0,t.Zp)();(0,a.useEffect)((()=>{(async()=>{try{const{data:e}=await i.A.get("/order/user",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});r(e.orders);const s=await Promise.all(e.orders.filter((e=>"completed"===e.status)).map((e=>i.A.get(`/feedback/exists/order/${e._id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})))),a={};s.forEach(((s,r)=>{const t=e.orders.filter((e=>"completed"===e.status))[r]._id;a[t]=s.data.exists})),f(a)}catch(a){var e,s;n.oR.error((null===(e=a.response)||void 0===e||null===(s=e.data)||void 0===s?void 0:s.message)||"Failed to fetch orders")}finally{p(!1)}})()}),[]);const S=s.filter((e=>e.orderNumber.toLowerCase().includes(x.toLowerCase())||e.status.toLowerCase().includes(x.toLowerCase()))),k=e=>{switch(e){case"processing":return(0,h.jsx)(c.TXh,{className:"status-icon processing"});case"shipped":return(0,h.jsx)(c.CE5,{className:"status-icon shipped"});case"completed":return(0,h.jsx)(c.A7C,{className:"status-icon completed"});case"cancelled":return(0,h.jsx)(c._Hm,{className:"status-icon cancelled"});default:return(0,h.jsx)(c.TXh,{className:"status-icon"})}},A=e=>{g(e),N(!0)};return u?(0,h.jsx)("div",{className:"loader",children:"Loading..."}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(l.A,{}),(0,h.jsx)("div",{className:"order-container",children:v?(0,h.jsxs)("div",{className:"order-detail-view",children:[(0,h.jsxs)("button",{onClick:()=>{g(null)},className:"back-button",children:[(0,h.jsx)(c.QVr,{})," Back to Orders"]}),(0,h.jsxs)("div",{className:"order-header",children:[(0,h.jsxs)("h2",{children:["Order #",v.orderNumber]}),(0,h.jsxs)("div",{className:`status-badge ${v.status}`,children:[k(v.status),(0,h.jsx)("span",{children:v.status.toUpperCase()})]})]}),(0,h.jsx)("div",{className:"order-timeline",children:(0,h.jsxs)("div",{className:"timeline-steps",children:[(0,h.jsxs)("div",{className:"step "+(["processing","shipped","completed"].includes(v.status)?"active":""),children:[(0,h.jsx)("div",{className:"step-icon",children:"1"}),(0,h.jsx)("div",{className:"step-label",children:"Processing"})]}),(0,h.jsxs)("div",{className:"step "+(["shipped","completed"].includes(v.status)?"active":""),children:[(0,h.jsx)("div",{className:"step-icon",children:"2"}),(0,h.jsx)("div",{className:"step-label",children:"Shipped"})]}),(0,h.jsxs)("div",{className:"step "+("completed"===v.status?"active":""),children:[(0,h.jsx)("div",{className:"step-icon",children:"3"}),(0,h.jsx)("div",{className:"step-label",children:"Delivered"})]})]})}),(0,h.jsxs)("div",{className:"order-details-grid",children:[(0,h.jsxs)("div",{className:"order-items",children:[(0,h.jsx)("h3",{children:"Order Items"}),(0,h.jsx)("ul",{children:v.items.map(((e,s)=>(0,h.jsx)("li",{children:(0,h.jsxs)("div",{className:"item-details",children:[(0,h.jsx)("h4",{children:e.medicineId.name}),(0,h.jsxs)("p",{children:["Quantity: ",e.quantity]}),(0,h.jsxs)("p",{children:["Price: Rs. ",e.price.toFixed(2)]})]})},s)))})]}),(0,h.jsxs)("div",{className:"order-summary",children:[(0,h.jsx)("h3",{children:"Order Summary"}),(0,h.jsxs)("div",{className:"summary-item",children:[(0,h.jsx)("span",{children:"Subtotal:"}),(0,h.jsxs)("span",{children:["Rs. ",v.subTotal.toFixed(2)]})]}),(0,h.jsxs)("div",{className:"summary-item",children:[(0,h.jsx)("span",{children:"Discount:"}),(0,h.jsxs)("span",{children:["-Rs. ",(v.subTotal-v.totalAmount).toFixed(2)]})]}),(0,h.jsxs)("div",{className:"summary-item total",children:[(0,h.jsx)("span",{children:"Total:"}),(0,h.jsxs)("span",{children:["Rs. ",v.totalAmount.toFixed(2)]})]}),"completed"===v.status&&(0,h.jsx)("div",{className:"review-section",children:(0,h.jsx)("button",{className:"review-btn "+(y[v._id]?"disable-btn":""),disabled:y[v._id],onClick:()=>A(v),children:y[v._id]?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(c.gt3,{})," You've reviewed this order"]}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(c.gt3,{})," Leave Pharmacy Review"]})})})]}),(0,h.jsxs)("div",{className:"shipping-info",children:[(0,h.jsx)("h3",{children:"Shipping Information"}),(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"Name:"})," ",v.patient.firstname," ",v.patient.lastname]}),(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"Address:"})," ",v.shippingInfo.address]}),(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"City:"})," ",v.shippingInfo.city]}),(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"Phone:"})," ",v.shippingInfo.phone]})]}),(0,h.jsxs)("div",{className:"pharmacy-info",children:[(0,h.jsx)("h3",{children:"Pharmacy Information"}),(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"Name:"})," ",v.pharmacy.name]}),(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"Address:"})," ",v.pharmacy.address]}),(0,h.jsxs)("p",{children:[(0,h.jsx)("strong",{children:"Phone:"})," ",v.pharmacy.phone]})]})]})]}):(0,h.jsxs)("div",{className:"order-list-view",children:[(0,h.jsx)("h2",{children:"My Orders"}),(0,h.jsxs)("div",{className:"search-bar",children:[(0,h.jsx)(c.KSO,{className:"search-icon"}),(0,h.jsx)("input",{type:"text",placeholder:"Search by order number or status...",value:x,onChange:e=>j(e.target.value)})]}),0===S.length?(0,h.jsxs)("div",{className:"no-orders",children:[(0,h.jsx)("p",{children:"You haven't placed any orders yet."}),(0,h.jsx)("button",{onClick:()=>w("/medicines"),className:"btn-primary",children:"Shop Now"})]}):(0,h.jsx)("div",{className:"orders-list",children:S.map((e=>(0,h.jsxs)("div",{className:"order-card",children:[(0,h.jsxs)("div",{className:"order-header",children:[(0,h.jsxs)("span",{className:"order-number",children:["#",e.orderNumber]}),(0,h.jsxs)("div",{className:`status-badge ${e.status}`,children:[k(e.status),(0,h.jsx)("span",{children:e.status.toUpperCase()})]})]}),(0,h.jsxs)("div",{className:"order-details",children:[(0,h.jsx)("div",{className:"order-date",children:(0,h.jsxs)("p",{children:["Order Date: ",new Date(e.createdAt).toLocaleDateString()]})}),(0,h.jsxs)("div",{className:"order-items-preview",children:[e.items.slice(0,3).map(((e,s)=>(0,h.jsx)("span",{children:e.medicineId.name},s))),e.items.length>3&&(0,h.jsxs)("span",{children:["+",e.items.length-3," more"]})]}),(0,h.jsx)("div",{className:"order-total",children:(0,h.jsxs)("p",{children:["Total: Rs. ",e.totalAmount.toFixed(2)]})})]}),(0,h.jsxs)("div",{className:"order-actions",children:[(0,h.jsxs)("button",{onClick:()=>(async e=>{try{const{data:s}=await i.A.get(`/order/track/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});g(s.order)}catch(a){var s,r;n.oR.error((null===(s=a.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||"Failed to fetch order details")}})(e._id),className:"btn-outline",children:[(0,h.jsx)(c.__w,{})," View Details"]}),"completed"===e.status&&(0,h.jsx)("button",{className:"review-btn "+(y[e._id]?"disable-btn":""),disabled:y[e._id],onClick:()=>A(e),children:y[e._id]?"Reviewed":"Review"})]})]},e._id)))})]})}),b&&v&&(0,h.jsx)(m.A,{order:v,onClose:()=>N(!1),onSubmit:async()=>{try{const{data:e}=await i.A.get("/order/user",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});r(e.orders),f((e=>({...e,[v._id]:!0})))}catch(e){console.error("Error refreshing orders:",e)}N(!1)},entityType:"pharmacy",entityId:v.pharmacy._id}),(0,h.jsx)(o.A,{})]})}},6998:(e,s,r)=>{r.d(s,{A:()=>l});var a=r(5043),t=r(5369),i=r(6213),n=r(3768),d=r(579);const l=e=>{var s,r,l;let{order:o,appointment:c,onClose:m,onSubmit:h,entityType:u,entityId:p}=e;const[x,j]=(0,a.useState)(0),[v,g]=(0,a.useState)(null),[b,N]=(0,a.useState)(""),[y,f]=(0,a.useState)(!1),w="doctor"===u?`${null===c||void 0===c||null===(s=c.doctorId)||void 0===s?void 0:s.firstname} ${null===c||void 0===c||null===(r=c.doctorId)||void 0===r?void 0:r.lastname}`:null===o||void 0===o||null===(l=o.pharmacy)||void 0===l?void 0:l.name;return(0,d.jsx)("div",{className:"feedback-modal-overlay",children:(0,d.jsxs)("div",{className:"feedback-modal",children:[(0,d.jsx)("button",{className:"close-btn",onClick:m,children:"\xd7"}),(0,d.jsx)("h2",{children:"Rate Your Experience"}),(0,d.jsxs)("p",{children:["How was your ","doctor"===u?"appointment":"order"," with ",w,"?"]}),(0,d.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),0!==x){f(!0);try{if(!u)throw new Error("Missing entity type");if(!p)throw new Error("Missing entity Id");const e={type:u,entityId:p,rating:x,comment:b||""};if("doctor"===u){if(null===c||void 0===c||!c._id)throw new Error("Appointment information is missing");e.appointmentId=c._id}else{if(null===o||void 0===o||!o._id)throw new Error("Order information is missing");e.orderId=o._id}console.log("Submitting feedback with payload:",e),await n.Ay.promise(i.A.post("/feedback/submit",e,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}}),{loading:"Submitting feedback...",success:"Feedback submitted successfully!",error:e=>{var s,r;return(null===(s=e.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||e.message||"Failed to submit feedback"}}),h()}catch(s){console.error("Feedback submission error:",s),n.Ay.error(s.message)}finally{f(!1)}}else n.Ay.error("Please select a rating")},children:[(0,d.jsx)("div",{className:"star-rating",children:[...Array(5)].map(((e,s)=>{const r=s+1;return(0,d.jsxs)("label",{children:[(0,d.jsx)("input",{type:"radio",name:"rating",value:r,onClick:()=>j(r)}),(0,d.jsx)(t.gt3,{className:"star",color:r<=(v||x)?"#ffc107":"#e4e5e9",size:40,onMouseEnter:()=>g(r),onMouseLeave:()=>g(null)})]},s)}))}),(0,d.jsxs)("div",{className:"form-group",children:[(0,d.jsx)("label",{htmlFor:"comment",children:"Your Feedback (optional)"}),(0,d.jsx)("textarea",{id:"comment",rows:"4",value:b,onChange:e=>N(e.target.value),placeholder:`Share details about your ${"doctor"===u?"appointment":"order"} experience...`})]}),(0,d.jsx)("button",{type:"submit",className:"submit-btn",disabled:0===x||y,children:y?"Submitting...":"Submit Feedback"})]})]})})}}}]);
//# sourceMappingURL=524.33938c38.chunk.js.map